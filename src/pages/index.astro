---
import MainLayout from "../layouts/MainLayout.astro";
import Navigation from "../components/Navigation.astro";
import BreadCrumb from "../components/BreadCrumb.astro";
import CarrouselScroll from "../components/CarrouselScroll.astro";
import CategoryCard from "../components/CategoryCard.astro";
import Banner from "../components/Banner.astro";
import Footer from "../components/Footer.astro";
import PrimaryButoon from "../components/PrimaryButton.astro";
import Newscard from "../components/Newscard.astro";

const newsData = await fetch("https://cgymdqjrjdkshxuerdil.supabase.co/rest/v1/Nyheder_Aktiviteter?limit=3", {
  method: "GET",
  headers: {
    apikey: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNneW1kcWpyamRrc2h4dWVyZGlsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTUxNjg4NjYsImV4cCI6MjAzMDc0NDg2Nn0.Wuj2B0mSu9HRIludgvymMYSNlhDMzV8213Fitr6A4bw",
  },
}).then((response) => response.json());

console.log("newsData", newsData);
---

<MainLayout title="Arbejdernes Tennisklub" />
<Navigation />

<div class="main">
  <section class="content">
    <h2>SENESTE NYT</h2>
    <div class="carousel-container">
      <div class="carousel-track">
        <div class="carousel-item"><CarrouselScroll date="01/01" headline="unbelievable" subheadline="UNREAL CLASH" /></div>
        <div class="carousel-item"><CarrouselScroll date="01/01" headline="unbelievable" subheadline="UNREAL CLASH" /></div>
        <div class="carousel-item"><CarrouselScroll date="01/01" headline="unbelievable" subheadline="UNREAL CLASH" /></div>
        <div class="carousel-item"><CarrouselScroll date="01/01" headline="unbelievable" subheadline="UNREAL CLASH" /></div>
        <div class="carousel-item"><CarrouselScroll date="01/01" headline="unbelievable" subheadline="UNREAL CLASH" /></div>
      </div>
      <div class="carousel-navigation">
        <img src="/img/svg/redarrowLeft_1.svg" id="prevButton" />
        <img src="/img/svg/redarrowRight_1.svg" id="nextButton" />
      </div>

    <div class="carousel-indicators">
      <div class="carousel-indicator active" data-slide-to="0"></div>
      <div class="carousel-indicator" data-slide-to="1"></div>
      <div class="carousel-indicator" data-slide-to="2"></div>
      <div class="carousel-indicator" data-slide-to="3"></div>
      <div class="carousel-indicator" data-slide-to="4"></div>
    </div>
  </section>
        <br>
        <br>
                  <div class=flexboxCenter>
                  <PrimaryButoon btnText="SE ALLE NYHEDER" link="/allenyheder"/>
                  </div>
    
        
    <section class="content"><h3>KOMMENDE AKTIVITETER</h3>
        <article class="autolayout">
          {newsData.map((news) => <Newscard news_image={news.news_image} date={news.date} headline={news.headline} subheadline={news.subheadline} />)}
        </article>
        <div class=flexboxCenter>
          <PrimaryButoon btnText="SE ALLE AKTIVITETER" link="/allenyheder"/>
        </div>
    </section>
    <br>
    <br>

  <section class="content">
    <div class="spacer">
    <article class="grid-2_2">
      <a href="/juniortraening"><CategoryCard imgPath="../img/juniorCategory.webp" title="JUNIOR" /></a>
      <a href="/motionisttraening"><CategoryCard imgPath="../img/seniorCategory.webp" title="SENIOR" /></a>
      <a href="/motionisttraening"><CategoryCard imgPath="../img/motionist_træning_hero.webp" title="MOTIONIST" /></a>
      <a href="/elitetraening"><CategoryCard imgPath="../img/elite_træning_hero.webp" title="ELITE" /></a>
    </article>
  </div>

  </section>
  <Banner src="bannerBg.png" btnTitle="TJEK MAKKERBØRS" />
</div>
<Footer />

<style>

  .carousel-track {
    display: flex;
    transition: transform 1s ease-in-out;
  }

  .carousel-container {
    width: 700px;
    display: flex;
    overflow: hidden;
    position: relative;
    margin: auto;
  }
  .carousel-track {
    display: flex;
    transition: transform 0.5s ease-in-out;
  }
  .carousel-item {
    flex: 0 0 100%;
  }
  .carousel-navigation {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 2;
  }
  .carousel-navigation img {
    background: rgba(255, 255, 255, 0.5);
    width: 50px;
    border: none;
    padding: 10px;
    cursor: pointer;
  }
  .carousel-indicators {
    position: absolute;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    z-index: 2;
  }
  .carousel-indicator {
    width: 10px;
    height: 10px;
    background-color: #ccc;
    border-radius: 50%;
    margin: 0 5px;
    cursor: pointer;
  }
  .carousel-indicator.active {
    background-color: #555;
  }
  
 
</style>

<script>
  const track = document.querySelector(".carousel-track") as HTMLElement;
  const items = document.querySelectorAll(".carousel-item") as NodeListOf<HTMLElement>;
  const totalItems = items.length;
  const itemWidth = items[0].offsetWidth;
  const indicators = document.querySelectorAll(".carousel-indicator");

  let index = 0;

  function updateCarousel() {
    track.style.transform = `translateX(-${index * itemWidth}px)`;
    updateIndicators();
  }

  function nextSlide() {
    index = index < totalItems - 1 ? index + 1 : 0;
    updateCarousel();
  }

  function prevSlide() {
    index = index > 0 ? index - 1 : totalItems - 1;
    updateCarousel();
  }

  function goToSlide(idx: number) {
    index = idx;
    updateCarousel();
  }

  function updateIndicators() {
    indicators.forEach((indicator, idx) => {
      if (idx === index) {
        indicator.classList.add("active");
      } else {
        indicator.classList.remove("active");
      }
    });
  }

  document.getElementById("nextButton")!.addEventListener("click", nextSlide);
  document.getElementById("prevButton")!.addEventListener("click", prevSlide);

  indicators.forEach((indicator) => {
    indicator.addEventListener("click", (event) => {
      const target = event.target as HTMLElement;
      const slideTo = target.getAttribute("data-slide-to");
      if (slideTo !== null) {
        goToSlide(parseInt(slideTo));
      }
    });
  });

  setInterval(nextSlide, 5000); // Auto slide every 5 seconds
</script>
